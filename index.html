<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recibo ‚Ä¢ Celso Motorista</title>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111826;
      --text:#eef2f8;
      --muted:#a8b3c7;
      --line:rgba(255,255,255,.10);

      /* Tema Laranja */
      --orange:#fb923c;
      --orange2:#f97316;
      --orange3:#ea580c;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(251,146,60,.16), transparent 60%),
        radial-gradient(1000px 650px at 88% 22%, rgba(249,115,22,.14), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    header{
      padding:20px 16px 10px;
      max-width:1200px;
      margin:0 auto;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    header h1{ margin:0; font-size:18px; font-weight:900; letter-spacing:.2px; }
    header p{ margin:6px 0 0; color:var(--muted); font-size:13px; max-width:860px; line-height:1.35; }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:12px 16px 28px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr} }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.04), transparent 40%), var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 10px 35px rgba(0,0,0,.35);
    }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .btns{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:850;
      font-size:13px;
      transition:.15s transform, .15s background, .15s border, .15s box-shadow;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px); }

    .btn-accent{ border-color: rgba(249,115,22,.45); }
    .btn-accent:hover{
      background: rgba(249,115,22,.12);
      box-shadow: 0 0 0 3px rgba(249,115,22,.12);
    }

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width: 620px){ .grid{ grid-template-columns:1fr; } }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:8px 0 6px;
    }
    input, textarea, select{
      width:100%;
      background: rgba(255,255,255,.05);
      color: var(--text);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
      font-size:13px;
    }
    textarea{ min-height:70px; resize:vertical; }
    input:focus, textarea:focus, select:focus{
      border-color: rgba(249,115,22,.55);
      box-shadow: 0 0 0 3px rgba(249,115,22,.14);
    }

    .hint{ color:var(--muted); font-size:12px; line-height:1.35; margin-top:10px; }

    /* ===== Preview "cart√£o" ===== */
    .receipt-stage{ display:flex; justify-content:center; padding:10px 0; }
    .receipt{
      width: 420px;
      max-width: 100%;
      background: #0b1220;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.42);
      position:relative;
    }
    .receipt:before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(720px 300px at 18% 0%, rgba(251,146,60,.16), transparent 55%),
        radial-gradient(720px 320px at 86% 12%, rgba(249,115,22,.14), transparent 60%);
      pointer-events:none;
    }

    .r-top{
      position:relative;
      padding:14px 16px 12px;
      border-bottom:1px dashed rgba(255,255,255,.14);
      background:
        linear-gradient(90deg, rgba(249,115,22,.18), rgba(249,115,22,0) 60%),
        rgba(255,255,255,.02);
    }
    .r-top-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }

    .logo-wrap{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 200px;
    }
    .logo{
      width:46px; height:46px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      display:grid;
      place-items:center;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .logo svg{ width:100%; height:100%; display:block; }

    .r-brand{
      font-weight:950;
      letter-spacing:.2px;
      font-size:14px;
      line-height:1.15;
    }
    .r-issuer{
      color:rgba(232,238,247,.90);
      font-size:12.5px;
      margin-top:4px;
    }

    .r-total{
      font-size:26px;
      font-weight:1000;
      letter-spacing:.2px;
      text-align:right;
      white-space:nowrap;
    }
    .r-meta{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      color:rgba(232,238,247,.88);
      font-family:var(--mono);
      font-size:12px;
      opacity:.95;
      flex-wrap:wrap;
    }

    .r-section{ padding:12px 16px; position:relative; }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(249,115,22,.28);
      background: rgba(249,115,22,.10);
      color:rgba(255,255,255,.92);
      font-size:11.5px;
      font-weight:900;
    }

    .r-blocktitle{
      margin:0 0 10px;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .r-msg{ color:rgba(232,238,247,.86); font-size:12px; }

    .r-address{ font-size:12.7px; line-height:1.35; color:rgba(232,238,247,.92); }
    .r-time{
      margin-top:8px;
      font-family:var(--mono);
      font-size:12px;
      color:rgba(232,238,247,.90);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .r-box{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .r-box .line{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      font-size:12.5px; padding:4px 0;
    }
    .r-box .label{ color:rgba(168,179,199,.95); }
    .r-box .value{ font-family:var(--mono); color:rgba(232,238,247,.95); }

    .r-lines{ border-top:1px solid rgba(255,255,255,.08); padding-top:10px; margin-top:12px; }
    .r-item{ display:flex; justify-content:space-between; gap:10px; font-size:12.5px; padding:5px 0; color:rgba(232,238,247,.92); }
    .r-item .k{ color:rgba(168,179,199,.95); }
    .r-item .v{ font-family:var(--mono); }
    .r-strong{ font-weight:1000; font-size:13.5px; }

    .r-foot{
      padding:12px 16px 16px;
      border-top:1px dashed rgba(255,255,255,.14);
      position:relative;
    }
    .r-foot a{ color: var(--orange); text-decoration:none; word-break:break-all; }
    .r-sub{ color:rgba(168,179,199,.95); font-size:12px; margin-top:8px; line-height:1.35; }

    /* ===== MODO A4 (PDF mais estiloso) ===== */
    /* Na tela, o preview √© o cart√£o. No print, vira A4 bonito. */
    @media print{
      body{ background:#fff; color:#000; }
      header, .wrap > .panel:first-child{ display:none !important; }

      .wrap{ padding:0; display:block; }
      .panel{ border:none; box-shadow:none; padding:0; }
      .receipt-stage{ padding:0; }

      /* For√ßa layout A4 */
      @page { size: A4; margin: 14mm; }

      .receipt{
        width: auto;
        max-width: none;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        box-shadow:none;
        background:#fff;
        color:#000;
      }
      .receipt:before{ display:none; }

      .r-top{
        background:
          linear-gradient(90deg, rgba(249,115,22,.18), rgba(249,115,22,0) 60%),
          #fff;
        border-bottom: 1px solid #e5e7eb;
      }
      .r-meta{ color:#111; }
      .r-address, .r-time, .r-item, .r-box .value{ color:#111; }
      .r-item .k, .r-box .label, .r-sub{ color:#374151; }
      .r-lines{ border-top:1px solid #e5e7eb; }
      .r-foot{ border-top:1px solid #e5e7eb; }
      .chip{
        border:1px solid rgba(249,115,22,.45);
        background: rgba(249,115,22,.10);
        color:#111;
      }
      .r-foot a{ color:#111; text-decoration:underline; }

      /* ‚ÄúAssinatura / carimbo‚Äù */
      .sign{
        margin-top:14px;
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:10px;
      }
      .sign .box{
        border:1px dashed #9ca3af;
        border-radius:12px;
        padding:12px;
        min-height:70px;
        font-size:12px;
        color:#374151;
      }
      .sign .title{ font-weight:800; color:#111; margin-bottom:6px; }
    }
    .sign{ display:none; } /* s√≥ aparece no print */
    @media print{ .sign{ display:grid; } }
  </style>
</head>

<body>
  <header>
    <div>
      <h1>Gerador de Recibo ‚Ä¢ Celso Motorista</h1>
      <p>
        Logo no PDF (SVG ou upload), modo de impress√£o A4 estiloso, e campos PJ completos (CNPJ/telefone/endere√ßo do emitente + CPF/CNPJ do cliente).
        Para gerar: clique em <b>Imprimir</b> e escolha ‚ÄúSalvar como PDF‚Äù.
      </p>
    </div>
    <div class="chip">üßæ Tema laranja ‚Ä¢ PDF A4</div>
  </header>

  <main class="wrap">
    <!-- Editor -->
    <section class="panel">
      <div class="toolbar">
        <div class="btns">
          <button class="btn-accent" id="btnPrint">Imprimir / Salvar PDF</button>
          <button id="btnCopyJson">Copiar JSON</button>
          <button id="btnDownloadJson">Baixar JSON</button>

          <label style="margin:0">
            <input id="fileLogo" type="file" accept="image/*" style="display:none" />
            <button type="button" id="btnLogo">Enviar logo (PNG/JPG)</button>
          </label>
          <button type="button" id="btnLogoReset">Voltar logo padr√£o</button>
        </div>

        <div class="btns">
          <button id="btnNow">Data/hora agora</button>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Marca (Topo)</label>
          <input data-bind="marca" placeholder="Celso Motorista" />
        </div>
        <div>
          <label>Emitente (nome)</label>
          <input data-bind="emissorNome" placeholder="Celso Motorista" />
        </div>

        <div>
          <label>CNPJ do emitente</label>
          <input data-bind="emissorCnpj" placeholder="00.000.000/0000-00" />
        </div>
        <div>
          <label>Telefone / WhatsApp</label>
          <input data-bind="emissorTelefone" placeholder="(88) 9xxxx-xxxx" />
        </div>

        <div style="grid-column:1/-1">
          <label>Endere√ßo do emitente</label>
          <input data-bind="emissorEndereco" placeholder="Rua..., Bairro..., Cidade - UF" />
        </div>

        <div>
          <label>Total (Topo)</label>
          <input data-bind="totalTopo" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>N¬∫ do Recibo</label>
          <input data-bind="reciboNumero" placeholder="000123" />
        </div>

        <div>
          <label>Data</label>
          <input data-bind="dataTopo" placeholder="dd/mm/aaaa" />
        </div>
        <div>
          <label>Hora</label>
          <input data-bind="horaTopo" placeholder="hh:mm:ss" />
        </div>

        <div>
          <label>Servi√ßo / Tipo</label>
          <input data-bind="tipo" placeholder="Corrida | Carro" />
        </div>
        <div>
          <label>Mensagem curta (opcional)</label>
          <input data-bind="mensagem" placeholder="Ex.: Viagem executiva ‚Ä¢ pagamento √† vista" />
        </div>

        <div>
          <label>Cliente (Nome)</label>
          <input data-bind="clienteNome" placeholder="Nome do cliente" />
        </div>
        <div>
          <label>Empresa do cliente (opcional)</label>
          <input data-bind="clienteEmpresa" placeholder="Nome da empresa (se houver)" />
        </div>

        <div>
          <label>Documento (tipo)</label>
          <select data-bind="docTipo">
            <option value="CPF">CPF</option>
            <option value="CNPJ">CNPJ</option>
          </select>
        </div>
        <div>
          <label>Documento (n√∫mero)</label>
          <input data-bind="docNumero" placeholder="000.000.000-00 ou 00.000.000/0000-00" />
        </div>

        <div style="grid-column:1/-1">
          <label>Origem</label>
          <textarea data-bind="origem" placeholder="Endere√ßo completo de origem"></textarea>
        </div>

        <div>
          <label>Hora in√≠cio</label>
          <input data-bind="horaInicio" placeholder="hh:mm:ss" />
        </div>
        <div>
          <label>Hora fim</label>
          <input data-bind="horaFim" placeholder="hh:mm:ss" />
        </div>

        <div style="grid-column:1/-1">
          <label>Destino</label>
          <textarea data-bind="destino" placeholder="Endere√ßo completo de destino"></textarea>
        </div>

        <div>
          <label>Ve√≠culo</label>
          <input data-bind="veiculo" placeholder="Marca / Modelo" />
        </div>
        <div>
          <label>Placa</label>
          <input data-bind="placa" placeholder="ABC1D23" />
        </div>

        <div>
          <label>KM (texto)</label>
          <input data-bind="kmTexto" placeholder="0,00 KM = R$ 0,00" />
        </div>
        <div>
          <label>Tempo (texto)</label>
          <input data-bind="tempoTexto" placeholder="0,00 min = R$ 0,00" />
        </div>

        <div>
          <label>Custo fixo</label>
          <input data-bind="custoFixo" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>Descontos/Ajustes</label>
          <input data-bind="descontos" placeholder="R$ 0,00" />
        </div>

        <div>
          <label>Saldo pendente</label>
          <input data-bind="saldoPendente" placeholder="R$ 0,00" />
        </div>
        <div>
          <label>Valor cobrado</label>
          <input data-bind="valorCobrado" placeholder="R$ 0,00" />
        </div>

        <div style="grid-column:1/-1">
          <label>Link do mapa (opcional)</label>
          <input data-bind="linkMapa" placeholder="https://..." />
        </div>

        <div>
          <label>Rodap√© (linha 1)</label>
          <input data-bind="rodape1" placeholder="Mensagem de rodap√©" />
        </div>
        <div>
          <label>Rodap√© (linha 2)</label>
          <input data-bind="rodape2" placeholder="Mensagem de rodap√©" />
        </div>
      </div>

      <p class="hint">
        A logo aparece no PDF. Se voc√™ enviar sua logo (PNG/JPG), ela fica salva localmente no navegador.
      </p>
    </section>

    <!-- Preview -->
    <section class="panel">
      <div class="receipt-stage">
        <article class="receipt" id="receipt">
          <div class="r-top">
            <div class="r-top-row">
              <div class="logo-wrap">
                <div class="logo" id="logoSlot">
                  <!-- SVG padr√£o (imprime perfeito) -->
                  <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-label="Celso Motorista">
                    <defs>
                      <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
                        <stop offset="0" stop-color="#fb923c"/>
                        <stop offset="1" stop-color="#f97316"/>
                      </linearGradient>
                    </defs>
                    <rect x="0" y="0" width="64" height="64" rx="16" fill="url(#g)"/>
                    <path d="M18 38c0-8 6-14 14-14h14v6H32c-4 0-8 4-8 8s4 8 8 8h14v6H32c-8 0-14-6-14-14Z" fill="rgba(255,255,255,.95)"/>
                    <circle cx="44.5" cy="41.5" r="4.5" fill="rgba(255,255,255,.95)"/>
                  </svg>
                </div>

                <div>
                  <div class="r-brand" id="v_marca">Celso Motorista</div>
                  <div class="r-issuer" id="v_emissorNome">Celso Motorista</div>
                </div>
              </div>

              <div style="text-align:right">
                <div class="r-total" id="v_totalTopo">R$ 0,00</div>
                <div class="r-meta">
                  <span>N¬∫ <span id="v_reciboNumero">‚Äî</span></span>
                  <span id="v_dataHora">‚Äî</span>
                </div>
              </div>
            </div>

            <div class="r-meta" style="margin-top:10px">
              <span>CNPJ: <span id="v_emissorCnpj">‚Äî</span></span>
              <span>Contato: <span id="v_emissorTelefone">‚Äî</span></span>
            </div>
            <div class="r-meta" style="margin-top:6px">
              <span id="v_emissorEndereco">‚Äî</span>
            </div>
          </div>

          <div class="r-section">
            <div class="r-blocktitle">
              <span class="chip" id="v_tipo">Corrida | Carro</span>
              <span class="r-msg" id="v_mensagem"></span>
            </div>

            <div class="r-address" id="v_origem">Origem‚Ä¶</div>
            <div class="r-time">
              <span><span class="k">In√≠cio:</span> <span id="v_horaInicio">--:--:--</span></span>
              <span><span class="k">Fim:</span> <span id="v_horaFim">--:--:--</span></span>
            </div>
            <div class="r-address" style="margin-top:10px" id="v_destino">Destino‚Ä¶</div>

            <div class="r-box">
              <div class="line"><span class="label">Cliente</span><span class="value" id="v_clienteNome">‚Äî</span></div>
              <div class="line" id="empresaRow"><span class="label">Empresa</span><span class="value" id="v_clienteEmpresa">‚Äî</span></div>
              <div class="line"><span class="label" id="v_docTipoLabel">CPF</span><span class="value" id="v_docNumero">‚Äî</span></div>
            </div>

            <div class="r-box" style="margin-top:10px">
              <div class="line"><span class="label">Ve√≠culo</span><span class="value" id="v_veiculo">‚Äî</span></div>
              <div class="line"><span class="label">Placa</span><span class="value" id="v_placa">‚Äî</span></div>
            </div>

            <div class="r-lines">
              <div class="r-item r-strong">
                <span class="k">Total</span>
                <span class="v" id="v_totalDetalhe">R$ 0,00</span>
              </div>

              <div class="r-item"><span class="k">KM</span><span class="v" id="v_kmTexto">‚Äî</span></div>
              <div class="r-item"><span class="k">Tempo</span><span class="v" id="v_tempoTexto">‚Äî</span></div>
              <div class="r-item"><span class="k">Custo fixo</span><span class="v" id="v_custoFixo">‚Äî</span></div>
              <div class="r-item"><span class="k">Descontos</span><span class="v" id="v_descontos">‚Äî</span></div>
              <div class="r-item"><span class="k">Saldo pendente</span><span class="v" id="v_saldoPendente">‚Äî</span></div>

              <div class="r-item r-strong" style="margin-top:6px">
                <span class="k">Valor cobrado</span>
                <span class="v" id="v_valorCobrado">R$ 0,00</span>
              </div>
            </div>
          </div>

          <div class="r-foot">
            <div id="mapWrap" style="display:none">
              <div class="r-item"><span class="k">Mapa / Link</span></div>
              <a id="v_linkMapa" href="#" target="_blank" rel="noopener noreferrer">https://...</a>
            </div>

            <div class="r-sub" id="v_rodape1">‚Äî</div>
            <div class="r-sub" id="v_rodape2">‚Äî</div>

            <!-- assinatura s√≥ no print -->
            <div class="sign">
              <div class="box">
                <div class="title">Assinatura do Cliente</div>
                <div>_____________________________________</div>
              </div>
              <div class="box">
                <div class="title">Celso Motorista</div>
                <div id="v_emitenteResumo">_____________________________________</div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "recibo_celso_v4";
    const LOGO_KEY = "recibo_celso_logo_dataurl";

    const defaults = {
      marca: "Celso Motorista",
      emissorNome: "Celso Motorista",
      emissorCnpj: "",
      emissorTelefone: "",
      emissorEndereco: "",

      reciboNumero: "",

      totalTopo: "R$ 0,00",
      dataTopo: "",
      horaTopo: "",

      tipo: "Corrida | Carro",
      mensagem: "",

      clienteNome: "",
      clienteEmpresa: "",
      docTipo: "CPF",
      docNumero: "",

      origem: "",
      horaInicio: "",
      horaFim: "",
      destino: "",

      veiculo: "",
      placa: "",

      totalDetalhe: "R$ 0,00",
      kmTexto: "",
      tempoTexto: "",
      custoFixo: "R$ 0,00",
      descontos: "R$ 0,00",
      saldoPendente: "R$ 0,00",
      valorCobrado: "R$ 0,00",

      linkMapa: "",

      rodape1: "Recibo gerado por Celso Motorista.",
      rodape2: "Obrigado pela prefer√™ncia."
    };

    const state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return structuredClone(defaults);
        const parsed = JSON.parse(raw);
        return { ...structuredClone(defaults), ...parsed };
      }catch(e){
        return structuredClone(defaults);
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state, null, 2));
    }

    function bindInputs(){
      document.querySelectorAll("[data-bind]").forEach(el => {
        const key = el.getAttribute("data-bind");
        el.value = state[key] ?? "";
        el.addEventListener("input", () => {
          state[key] = el.value;
          saveState();
          render();
        });
        el.addEventListener("change", () => {
          state[key] = el.value;
          saveState();
          render();
        });
      });
    }

    function setText(id, value){
      const el = document.getElementById(id);
      if(el) el.textContent = value ?? "";
    }

    function smartDash(s){ return (s && String(s).trim()) ? String(s).trim() : "‚Äî"; }

    function render(){
      setText("v_marca", smartDash(state.marca));
      setText("v_emissorNome", smartDash(state.emissorNome));

      setText("v_emissorCnpj", smartDash(state.emissorCnpj));
      setText("v_emissorTelefone", smartDash(state.emissorTelefone));
      setText("v_emissorEndereco", smartDash(state.emissorEndereco));

      setText("v_totalTopo", smartDash(state.totalTopo));
      setText("v_reciboNumero", smartDash(state.reciboNumero));

      const data = smartDash(state.dataTopo);
      const hora = smartDash(state.horaTopo);
      setText("v_dataHora", (data !== "‚Äî" || hora !== "‚Äî") ? `${data} ${hora}`.trim() : "‚Äî");

      setText("v_tipo", smartDash(state.tipo));
      const msg = (state.mensagem || "").trim();
      setText("v_mensagem", msg ? ("‚Ä¢ " + msg) : "");

      setText("v_origem", (state.origem || "").trim() || "Origem‚Ä¶");
      setText("v_horaInicio", (state.horaInicio || "").trim() || "--:--:--");
      setText("v_horaFim", (state.horaFim || "").trim() || "--:--:--");
      setText("v_destino", (state.destino || "").trim() || "Destino‚Ä¶");

      setText("v_clienteNome", smartDash(state.clienteNome));
      setText("v_docTipoLabel", smartDash(state.docTipo));
      setText("v_docNumero", smartDash(state.docNumero));

      const empresa = (state.clienteEmpresa || "").trim();
      const empresaRow = document.getElementById("empresaRow");
      setText("v_clienteEmpresa", empresa || "‚Äî");
      empresaRow.style.display = empresa ? "" : "none";

      setText("v_veiculo", smartDash(state.veiculo));
      setText("v_placa", smartDash(state.placa));

      setText("v_totalDetalhe", smartDash(state.totalDetalhe));
      setText("v_kmTexto", (state.kmTexto || "").trim() || "‚Äî");
      setText("v_tempoTexto", (state.tempoTexto || "").trim() || "‚Äî");
      setText("v_custoFixo", smartDash(state.custoFixo));
      setText("v_descontos", smartDash(state.descontos));
      setText("v_saldoPendente", smartDash(state.saldoPendente));
      setText("v_valorCobrado", smartDash(state.valorCobrado));

      const link = (state.linkMapa || "").trim();
      const mapWrap = document.getElementById("mapWrap");
      const a = document.getElementById("v_linkMapa");
      if(link){
        mapWrap.style.display = "";
        a.textContent = link;
        a.href = link;
      }else{
        mapWrap.style.display = "none";
        a.textContent = "";
        a.href = "#";
      }

      setText("v_rodape1", (state.rodape1 || "").trim() || "‚Äî");
      setText("v_rodape2", (state.rodape2 || "").trim() || "‚Äî");

      // resumo no bloco "Celso Motorista" da assinatura
      const resumo = [
        (state.emissorNome || "").trim(),
        (state.emissorCnpj || "").trim() ? ("CNPJ: " + state.emissorCnpj.trim()) : "",
        (state.emissorTelefone || "").trim() ? ("Contato: " + state.emissorTelefone.trim()) : ""
      ].filter(Boolean).join(" ‚Ä¢ ");
      setText("v_emitenteResumo", resumo || "_____________________________________");

      renderLogoFromStorage();
    }

    function pad2(n){ return String(n).padStart(2,"0"); }
    function formatDateBR(d){ return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`; }
    function formatTime(d){ return `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`; }

    // ===== LOGO (upload e armazenamento) =====
    function renderLogoFromStorage(){
      const slot = document.getElementById("logoSlot");
      const dataUrl = localStorage.getItem(LOGO_KEY);
      if(dataUrl){
        slot.innerHTML = `<img alt="Logo Celso Motorista" src="${dataUrl}">`;
      } // sen√£o fica o SVG padr√£o (j√° no HTML)
    }

    function resetLogo(){
      localStorage.removeItem(LOGO_KEY);
      const slot = document.getElementById("logoSlot");
      slot.innerHTML = `
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-label="Celso Motorista">
          <defs>
            <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#fb923c"/>
              <stop offset="1" stop-color="#f97316"/>
            </linearGradient>
          </defs>
          <rect x="0" y="0" width="64" height="64" rx="16" fill="url(#g)"/>
          <path d="M18 38c0-8 6-14 14-14h14v6H32c-4 0-8 4-8 8s4 8 8 8h14v6H32c-8 0-14-6-14-14Z" fill="rgba(255,255,255,.95)"/>
          <circle cx="44.5" cy="41.5" r="4.5" fill="rgba(255,255,255,.95)"/>
        </svg>`;
    }

    // ===== A√ß√µes =====
    document.getElementById("btnPrint").addEventListener("click", () => window.print());

    document.getElementById("btnNow").addEventListener("click", () => {
      const d = new Date();
      state.dataTopo = formatDateBR(d);
      state.horaTopo = formatTime(d);
      saveState();
      bindInputs();
      render();
      toast("Data/hora atualizadas ‚úÖ");
    });

    // JSON
    document.getElementById("btnCopyJson").addEventListener("click", async () => {
      const json = JSON.stringify(state, null, 2);
      try{
        await navigator.clipboard.writeText(json);
        toast("JSON copiado ‚úÖ");
      }catch(e){
        toast("N√£o consegui copiar. Use Baixar JSON.");
      }
    });

    document.getElementById("btnDownloadJson").addEventListener("click", () => {
      const json = JSON.stringify(state, null, 2);
      const blob = new Blob([json], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "recibo_celso_motorista.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast("Baixado üì¶");
    });

    // Upload logo
    const fileLogo = document.getElementById("fileLogo");
    document.getElementById("btnLogo").addEventListener("click", () => fileLogo.click());
    fileLogo.addEventListener("change", async () => {
      const file = fileLogo.files?.[0];
      if(!file) return;

      // converte para DataURL (fica embutido e imprime no PDF)
      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = String(reader.result || "");
        localStorage.setItem(LOGO_KEY, dataUrl);
        render();
        toast("Logo aplicada ‚úÖ");
      };
      reader.readAsDataURL(file);
      fileLogo.value = "";
    });

    document.getElementById("btnLogoReset").addEventListener("click", () => {
      resetLogo();
      toast("Logo padr√£o restaurada ‚úÖ");
    });

    // Toast
    let toastTimer = null;
    function toast(msg){
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id = "toast";
        el.style.position = "fixed";
        el.style.bottom = "14px";
        el.style.left = "50%";
        el.style.transform = "translateX(-50%)";
        el.style.padding = "10px 12px";
        el.style.borderRadius = "999px";
        el.style.border = "1px solid rgba(249,115,22,.25)";
        el.style.background = "rgba(15,23,36,.92)";
        el.style.color = "rgba(232,238,247,.96)";
        el.style.backdropFilter = "blur(10px)";
        el.style.fontSize = "13px";
        el.style.fontWeight = "950";
        el.style.boxShadow = "0 10px 30px rgba(0,0,0,.35)";
        el.style.zIndex = "9999";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = "1";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { el.style.opacity = "0"; }, 1600);
    }

    // Init
    bindInputs();
    render();
  </script>
</body>
</html>
